<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Estimación de rendimiento en trigo/maíz</title>
    <meta charset="utf-8" />
    <meta name="author" content="Francisco Zambrano" />
    <script src="libs/xaringanExtra_fit-screen-0.2.3.9000/fit-screen.js"></script>
    <script src="libs/xaringanExtra-webcam-0.0.1/webcam.js"></script>
    <script id="xaringanExtra-webcam-options" type="application/json">{"width":"200","height":"200","margin":"1em"}</script>
    <link href="libs/xaringanExtra-extra-styles-0.2.3.9000/xaringanExtra-extra-styles.css" rel="stylesheet" />
    <script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
    <script src="libs/jquery-1.12.4/jquery.min.js"></script>
    <link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
    <script src="libs/leaflet-1.3.1/leaflet.js"></script>
    <link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
    <script src="libs/Proj4Leaflet-1.0.1/proj4-compressed.js"></script>
    <script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
    <link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
    <script src="libs/leaflet-binding-2.0.3/leaflet.js"></script>
    <script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
    <script src="libs/leaflet-providers-plugin-2.0.3/leaflet-providers-plugin.js"></script>
    <script src="libs/FlatGeoBuf-3.3.3/fgb.js"></script>
    <script src="libs/FlatGeoBuf-3.3.3/flatgeobuf-geojson.min.js"></script>
    <script src="libs/chromajs-2.1.0/chroma.min.js"></script>
    <link id="pol-1-attachment" rel="attachment" href="libs/pol-0.0.1/pol_layer.fgb"/>
    <link href="libs/HomeButton-0.0.1/home-button.css" rel="stylesheet" />
    <script src="libs/HomeButton-0.0.1/home-button.js"></script>
    <script src="libs/HomeButton-0.0.1/easy-button-src.min.js"></script>
    <script src="libs/clipboard-0.0.1/setClipboardText.js"></script>
    <link href="libs/mapviewCSS-0.0.1/mapview-popup.css" rel="stylesheet" />
    <link href="libs/mapviewCSS-0.0.1/mapview.css" rel="stylesheet" />
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
    <link rel="stylesheet" href="font-awesome-animation.min.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Estimación de rendimiento en trigo/maíz
## CGM + Remote Sensing
### Francisco Zambrano
### Hémera, Universidad Mayor
### 6 enero 2021

---




### Reunión SISSA: Interrogantes 

1. Datos de rendimiento/biomasa en trigo

2. Escala de estimación de rendimiento

  - Local?
  - Regional?

3. Modelo de crecimiento de cultivo (CGMs) a utilizar 

4. Uso de datos satelitales para estimación de rendimiento

---
### 1. Datos de rendimiento/biomasa en trigo

- En Chile no hay siponibilidad de una base de datos productiva de cultivos a nivel comuna, distrito o local.

- Está la base de datos de ODEPA/INE que se actualiza en base al censo agropecuario 2007 a nivel regional.

- Aún no se actualiza el censo agropecuario.

  - Una buena alternativa para recopilar datos a gran escala.
  
- Es necesario desarrollar una BBDD productiva para Chile.

  - Hay datos? Dónde están? qué calidad tienen?
  
---
### 2. Escala de estimación de rendimiento

- La escala está supeditada al modelo a elegir.

- Escala local: 
  - cuidadosa parametrización
  - mayor necesidad de computo

- Escala moderada a regional
  - no representa tan bien la condiciones locales
  - menor precisión en la estimación
  - indica patrones 
  - útil para evaluación de sequía


---
### 3. Crop Growth Models (CGM)

`Jin et al. (2018)`

.center[
  &lt;img src="./figs/CGMs.png"  width="100%" /&gt;
]

---
### 3. Crop Growth Models (CGM)

Simple Algorithm for Yield Estimation (SAFY) `(Duchemin et al. 2007)`

- Desarrollado específicamente para aplicaciones con remote sensing.

- Una teoría simple que relaciona la fitomasa total producida con la radiación fotosintéticamente activa (APAR) absorvida por la planta.

---
### 4. Uso de datos satelitales para estimación de rendimiento

Simple Algorithm for Yield Estimation (**SAFY**) `(Duchemin et al. 2007)`

.center[
  &lt;img src="./figs/parameters_SAFY.png"  width="100%" /&gt;
]

---
### 4. Uso de datos satelitales para estimación de rendimiento

Data assimilation `(Huang et al., 2019)`

CGM + Remote Sensing

.center[
  &lt;img src="./figs/data_assimilation_framework.jpg"  width="70%" /&gt;
]

---
### 4. Uso de datos satelitales para estimación de rendimiento

Data assimilation `(Huang et al., 2019)`

Varios métodos DA 

1. Aproximación variacional 

2. Filtros de Kalman

3. Bayesian Monte-Carlo

---
### 4. Uso de datos satelitales para estimación de rendimiento

Data assimilation `(Huang et al., 2019)`


.center[
  &lt;img src="./figs/DA_numerical_weather_forecast.jpg"  width="80%" /&gt;
]

---
### 4. Uso de datos satelitales para estimación de rendimiento

Ejemplo: Data assimilation + SAFY `(Silvestro et al., 2017)`

Del análisis de sensibibilidad se identificaron 8 parámetros

.center[
  &lt;img src="./figs/sensible_parameters_SAFY.png"  width="100%" /&gt;
]

---
### 4. Uso de datos satelitales para estimación de rendimiento

Resultados a nivel local `(Silvestro et al., 2017)`

.center[
  &lt;img src="./figs/results_SAFY_aquacrop.png"  width="100%" /&gt;
]



---
### 4. Uso de datos satelitales para estimación de rendimiento
 
1. La data assimilation con datos satelitales mejora la estimación de rendimiento de los CGM (ej. aquacrop, DSSAT, SAFY)

2. Los resultados de SAFY a escala local con limitado uso de datos satelitales (3/4) mejoró respecto a DA Aquacrop.

3. El bajo costo computacional y cantidad de parámetros necesarios hace de SAFY un CGM candidato interesante de evaular con DA.

---
### Ensayos en trigo y maíz 2020-2021

<div id="htmlwidget-06c661c9103876a9d948" style="width:720px;height:504px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-06c661c9103876a9d948">{"x":{"options":{"minZoom":1,"maxZoom":52,"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"preferCanvas":false,"bounceAtZoomLimits":false,"maxBounds":[[[-90,-370]],[[90,370]]]},"calls":[{"method":"addProviderTiles","args":["CartoDB.Positron","CartoDB.Positron","CartoDB.Positron",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["CartoDB.DarkMatter","CartoDB.DarkMatter","CartoDB.DarkMatter",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["OpenStreetMap","OpenStreetMap","OpenStreetMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["Esri.WorldImagery","Esri.WorldImagery","Esri.WorldImagery",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["OpenTopoMap","OpenTopoMap","OpenTopoMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"createMapPane","args":["polygon",420]},{"method":"addFlatGeoBuf","args":["pol","pol",null,true,"mvFeatureId",{"radius":6,"stroke":true,"color":"#333333","weight":0.5,"opacity":0.9,"fill":true,"fillColor":"#6666FF","fillOpacity":0.6},{"className":"","pane":"polygon"},"mapview-popup",{"radius":{"to":[3,15],"from":[3,15]},"weight":{"to":[1,10],"from":[1,10]},"opacity":{"to":[0,1],"from":[0,1]},"fillOpacity":{"to":[0,1],"from":[0,1]}}]},{"method":"addScaleBar","args":[{"maxWidth":100,"metric":true,"imperial":true,"updateWhenIdle":true,"position":"bottomleft"}]},{"method":"addHomeButton","args":[-71.5984992144113,-36.4057793156491,-71.5205150002142,-36.3747290508543,"pol","Zoom to pol","<strong> pol <\/strong>","bottomright"]},{"method":"addLayersControl","args":[["CartoDB.Positron","CartoDB.DarkMatter","OpenStreetMap","Esri.WorldImagery","OpenTopoMap"],"pol",{"collapsed":true,"autoZIndex":true,"position":"topleft"}]},{"method":"addLegend","args":[{"colors":["#6666FF"],"labels":["pol"],"na_color":null,"na_label":"NA","opacity":1,"position":"topright","type":"factor","title":"","extra":null,"layerId":null,"className":"info legend","group":"pol"}]}],"fitBounds":[-36.4057793156491,-71.5984992144113,-36.3747290508543,-71.5205150002142,[]]},"evals":[],"jsHooks":{"render":[{"code":"function(el, x, data) {\n  return (\n      function(el, x, data) {\n      // get the leaflet map\n      var map = this; //HTMLWidgets.find('#' + el.id);\n      // we need a new div element because we have to handle\n      // the mouseover output separately\n      // debugger;\n      function addElement () {\n      // generate new div Element\n      var newDiv = $(document.createElement('div'));\n      // append at end of leaflet htmlwidget container\n      $(el).append(newDiv);\n      //provide ID and style\n      newDiv.addClass('lnlt');\n      newDiv.css({\n      'position': 'relative',\n      'bottomleft':  '0px',\n      'background-color': 'rgba(255, 255, 255, 0.7)',\n      'box-shadow': '0 0 2px #bbb',\n      'background-clip': 'padding-box',\n      'margin': '0',\n      'padding-left': '5px',\n      'color': '#333',\n      'font': '9px/1.5 \"Helvetica Neue\", Arial, Helvetica, sans-serif',\n      'z-index': '700',\n      });\n      return newDiv;\n      }\n\n\n      // check for already existing lnlt class to not duplicate\n      var lnlt = $(el).find('.lnlt');\n\n      if(!lnlt.length) {\n      lnlt = addElement();\n\n      // grab the special div we generated in the beginning\n      // and put the mousmove output there\n\n      map.on('mousemove', function (e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                           ' lon: ' + (e.latlng.lng).toFixed(5) +\n                           ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                           ' | zoom: ' + map.getZoom() +\n                           ' | x: ' + L.CRS.EPSG3857.project(e.latlng).x.toFixed(0) +\n                           ' | y: ' + L.CRS.EPSG3857.project(e.latlng).y.toFixed(0) +\n                           ' | epsg: 3857 ' +\n                           ' | proj4: +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs ');\n      } else {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      }\n      });\n\n      // remove the lnlt div when mouse leaves map\n      map.on('mouseout', function (e) {\n      var strip = document.querySelector('.lnlt');\n      if( strip !==null) strip.remove();\n      });\n\n      };\n\n      //$(el).keypress(67, function(e) {\n      map.on('preclick', function(e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      var txt = document.querySelector('.lnlt').textContent;\n      console.log(txt);\n      //txt.innerText.focus();\n      //txt.select();\n      setClipboardText('\"' + txt + '\"');\n      }\n      });\n\n      }\n      ).call(this.getMap(), el, x, data);\n}","data":null},{"code":"function(el, x, data) {\n  return (function(el,x,data){\n           var map = this;\n\n           map.on('keypress', function(e) {\n               console.log(e.originalEvent.code);\n               var key = e.originalEvent.code;\n               if (key === 'KeyE') {\n                   var bb = this.getBounds();\n                   var txt = JSON.stringify(bb);\n                   console.log(txt);\n\n                   setClipboardText('\\'' + txt + '\\'');\n               }\n           })\n        }).call(this.getMap(), el, x, data);\n}","data":null}]}}</script>

---
### Referencias

Jin, X., Kumar, L., Li, Z., Feng, H., Xu, X., Yang, G., &amp; Wang, J. (2018). A review of data assimilation of remote sensing and crop models. European Journal of Agronomy, 92, 141–152. https://doi.org/10.1016/j.eja.2017.11.002

Duchemin, B., Maisongrande, P., Boulet, G., &amp; Benhadj, I. (2008). A simple algorithm for yield estimates: Evaluation for semi-arid irrigated winter wheat monitored with green leaf area index. Environmental Modelling and Software. https://doi.org/10.1016/j.envsoft.2007.10.003

Huang, J., Gómez-Dans, J. L., Huang, H., Ma, H., Wu, Q., Lewis, P. E., Liang, S., Chen, Z., Xue, J. H., Wu, Y., Zhao, F., Wang, J., &amp; Xie, X. (2019). Assimilation of remote sensing into crop growth models: Current status and perspectives. In Agricultural and Forest Meteorology (Vols. 276–277, p. 107609). Elsevier B.V. https://doi.org/10.1016/j.agrformet.2019.06.008

Silvestro, P., Pignatti, S., Pascucci, S., Yang, H., Li, Z., Yang, G., Huang, W., &amp; Casa, R. (2017). Estimating Wheat Yield in China at the Field and District Scale from the Assimilation of Satellite Data into the Aquacrop and Simple Algorithm for Yield (SAFY) Models. Remote Sensing, 9(5), 509. https://doi.org/10.3390/rs9050509
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
